
import ./{runner/settings}!
import ./{runner/cli}!

import ./{runner/select}!
import ./{runner/execute}!
import ./{runner/summary}!
import ./{runner/details}!

as: $[object :any target :type][
    to target object
]

if unknownArguments? args [
    unknowns: unknownArguments args
        | map => express
        | join.with: ", "

    print help
    panic ~"Unknown argument(s): |unknowns|."
]

if helpAsked? args [
    print help
    exit 0
]

fileSettings: (exists? "config.art")?
    -> # "config.art"!
    -> read.toml "unitt.toml"

settings: settings args fileSettings

delete.directory ".unitt"

allTests: listTests settings
result: executeTests allTests
    | details not? settings\clean
    | summary


if and? 0 < result\failed, not? settings\silent [
    panic "Some tests failed"
]